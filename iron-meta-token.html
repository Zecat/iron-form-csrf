<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/legacy/class.html">
<link rel="import" href="../iron-meta/iron-meta.html">
<link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html">

<script>

  class IronMetaToken 
    extends Polymer.mixinBehaviors(
      [Polymer.IronFormElementBehavior],
      Polymer.Element){
    
    static get is() {
      return 'iron-meta-token'
    }

    ready () {
      super.ready();
      this._ensureAttribute('hidden', true);
      Polymer.RenderStatus.afterNextRender(this, function() {
        let ironMeta = new Polymer.IronMeta({key: 'csrf_token'});
        let value = "";
        if (ironMeta.value 
          && (value = ironMeta.value.token) 
          && (name = ironMeta.value.name)) {
          this.value = value;
          this.name = name;
        } else {
          console.warn('You must provide a token value and name using <iron-meta-set-token> for your forms to contain a token.');
        }
      }.bind(this));
    }
  }
  window.customElements.define(IronMetaToken.is, IronMetaToken);
</script>
